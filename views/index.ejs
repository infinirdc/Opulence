<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Opulence | Haute Gastronomie</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

    <div class="hero-section">
        <div class="hero-content">
            <h3 style="color: var(--primary); letter-spacing: 4px; text-transform: uppercase;">Restaurant Gastronomique</h3>
            <h1 class="elegant-title">OPULENCE</h1>
            <p style="font-style: italic; margin-bottom: 20px; color: #ddd;">L'Art de l'Excellence Culinaire</p>
            <button class="btn-primary" onclick="document.getElementById('menu').scrollIntoView()">Découvrir la Carte</button>
        </div>
    </div>

    <div style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
        <button class="btn-primary" onclick="toggleCart()">
            <i class="fas fa-utensils"></i> <span id="cart-count">0</span>
        </button>
    </div>

    <% if (query.success) { %>
        <div style="background: var(--primary); color: #000; padding: 15px; text-align: center; font-weight: bold;">
            ✨ Votre commande a été transmise au Chef.
        </div>
    <% } %>

    <div id="menu" class="menu-container">
        <h2 style="text-align: center; margin-bottom: 40px; font-weight: 300; letter-spacing: 2px;">NOTRE SÉLECTION</h2>
        
        <% if (!plats || plats.length === 0) { %>
            <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                <i class="fas fa-wine-glass-alt" style="font-size: 3rem; margin-bottom: 20px; color: var(--primary);"></i>
                <p>La carte est en cours d'élaboration par nos Chefs.</p>
            </div>
        <% } else { %>
            <div class="menu-grid">
                <% plats.forEach(plat => { %>
                    <div class="dish-card">
                        <img src="<%= plat.image || 'https://source.unsplash.com/200x200/?fine-dining,food' %>" class="dish-img">
                        <div class="dish-info">
                            <h3><%= plat.nom %></h3>
                            <p class="dish-desc"><%= plat.description || "Une création unique du Chef." %></p>
                            <div class="dish-footer">
                                <span class="price"><%= plat.prix %> $</span>
                                <button class="btn-icon" onclick="addToCart('<%= plat._id %>', '<%= plat.nom %>', <%= plat.prix %>)">
                                    Ajouter
                                </button>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>
    </div>

    <div id="cartModal" class="modal-overlay" style="display:none;">
        <div class="card-dark" style="width: 400px; max-width: 90%;">
            <h2 style="margin-top:0; color: var(--primary);">Votre Dégustation</h2>
            <ul id="cart-items" style="list-style: none; padding: 0; color: var(--text-gray); max-height: 200px; overflow-y: auto;"></ul>
            <div style="text-align: right; margin: 20px 0; font-size: 1.2rem;">Total: <span id="cart-total" style="color:white">0</span> $</div>
            
            <form action="/commander" method="POST">
                <input type="hidden" name="panierJson" id="panierInput">
                <input type="text" name="clientNom" placeholder="Nom de la réservation / Table" required>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button type="button" class="btn-secondary" onclick="toggleCart()">Retour</button>
                    <button type="submit" class="btn-primary" style="flex: 1;">Confirmer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let cart = [];
        function toggleCart() {
            const el = document.getElementById('cartModal');
            el.style.display = el.style.display === 'flex' ? 'none' : 'flex';
        }
        function addToCart(id, nom, prix) {
            const existing = cart.find(i => i.id === id);
            if(existing) existing.qty++; else cart.push({id, nom, prix, qty:1});
            updateUI();
        }
        function updateUI() {
            document.getElementById('cart-count').innerText = cart.reduce((a,b)=>a+b.qty,0);
            const list = document.getElementById('cart-items');
            list.innerHTML = '';
            let total = 0;
            cart.forEach(i => {
                total += i.prix * i.qty;
                list.innerHTML += `<li style="display:flex; justify-content:space-between; padding: 10px 0; border-bottom:1px solid rgba(255,255,255,0.1);">
                    <span><b>${i.qty}x</b> ${i.nom}</span> 
                    <span>${(i.prix*i.qty).toFixed(2)}$</span>
                </li>`;
            });
            document.getElementById('cart-total').innerText = total.toFixed(2);
            document.getElementById('panierInput').value = JSON.stringify(cart);
        }
    </script>
</body>
</html>
